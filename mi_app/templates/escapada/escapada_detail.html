{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle de Escapada - {{ escapada.nombre }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white shadow rounded-lg p-6">
  <h2 class="text-2xl font-bold mb-4">Detalle de Escapada: {{ escapada.nombre }}</h2>
  
  <!-- Detalles de la escapada -->
  <div class="mb-4 space-y-2">
    <p><strong>Tipo:</strong> {{ escapada.get_tipo_display }}</p>
    <p><strong>Plazas:</strong> {{ escapada.num_plazas }}</p>
    <p><strong>Inscritos:</strong> {{ escapada.num_inscritos }}</p>
    <p><strong>Fechas:</strong> {{ escapada.fecha_ini }} a {{ escapada.fecha_fin }}</p>
    <p><strong>Lugar:</strong> {{ escapada.lugar }}</p>
    <p><strong>Estado:</strong> {{ escapada.estado }}</p>
    {% if escapada.descripcion %}
      <p><strong>Descripción:</strong> {{ escapada.descripcion }}</p>
    {% endif %}

    <!-- Verificar si existe escapada.imagen -->
    {% if escapada.imagen %}
      <div class="mt-4">
        <img src="{{ escapada.imagen.url }}" alt="{{ escapada.nombre }}" class="w-full rounded">
      </div>
    {% else %}
      <p class="mt-4 text-gray-500">No hay imagen para esta escapada.</p>
    {% endif %}
  </div>

  <!-- Botones de Acción -->
  <div class="flex space-x-4">
    <a href="{% url 'escapada_update' escapada.pk %}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Editar</a>
    <a href="{% url 'escapada_delete' escapada.pk %}" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Eliminar</a>
    <a href="{% url 'escapada_list' %}" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">Volver a la Lista</a>
  </div>

  <!-- Mostrar Alojamientos -->
  <div class="mt-6">
    <h3 class="text-xl font-semibold">Alojamientos Asignados</h3>
    <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for alojamiento_rel in escapada.escapadas_alojamiento.all %}
        {% if alojamiento_rel.alojamiento.imagen %}
          <!-- Si existe imagen del alojamiento -->
          <div class="bg-cover bg-center rounded-lg shadow-lg relative" 
               style="background-image: url('{{ alojamiento_rel.alojamiento.imagen.url }}'); height: 200px;">
            <div class="bg-black bg-opacity-50 text-white p-4 absolute bottom-0 left-0 w-full">
              <h4 class="font-bold">{{ alojamiento_rel.alojamiento.nombre }}</h4>
              <p>{{ alojamiento_rel.alojamiento.direccion }}</p>
            </div>
          </div>
        {% else %}
          <!-- Si no existe imagen, muestra un fondo gris o imagen por defecto -->
          <div class="bg-gray-200 rounded-lg shadow-lg relative flex items-center justify-center" style="height:200px;">
            <span class="text-gray-700 font-semibold">Sin imagen</span>
            <div class="bg-black bg-opacity-30 text-white p-4 absolute bottom-0 left-0 w-full">
              <h4 class="font-bold">{{ alojamiento_rel.alojamiento.nombre }}</h4>
              <p>{{ alojamiento_rel.alojamiento.direccion }}</p>
            </div>
          </div>
        {% endif %}
      {% empty %}
        <div class="bg-white p-4 rounded-lg shadow-lg text-center">
          <p>No hay alojamientos asignados. Haz clic en el botón para añadir uno.</p>
        </div>
      {% endfor %}

      <!-- Botón para agregar más alojamientos -->
      <a href="{% url 'escapada_alojamiento_select' escapada.pk %}"
         class="bg-blue-600 text-white rounded-lg shadow-lg flex justify-center items-center h-48 hover:bg-blue-700">
        <span class="text-4xl">+</span>
      </a>
    </div>
  </div>
</div>
{% endblock %}
